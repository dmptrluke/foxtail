{% extends "base.html" %}
{% load humanize account cache %}

{% block title_full %}{{ request.site.name }}{% endblock title_full %}

{% block content %}
    <h1>Welcome to {{ request.site.name }}</h1>

    <p>
        Welcome to {{ request.site.name }}, the resource for New Zealand <a
            href="https://www.anthrocon.org/what-is-furry/" target="_blank" rel="noopener noreferrer"
            data-toggle="tooltip" class="text-decoration-none" title="What is a furry?">furries</a>!
        Most of the functionality of site is currently under construction, but we've launched the parts of the website
        that are ready so far so you can log in and manage your {{ request.site.name }} account.
    </p>

    {% if user.is_authenticated %}
        <p class="mb-4">
            You're now logged in as <strong>{% user_display user %}</strong>! Use the buttons below to manage
            your {{ request.site.name }}
            account.
        </p>
        <form method="post" action="{% url 'account_logout' %}?next={{ request.path }}">
            <p class="mb-5">
                <a href="{% url 'account_profile' %}" class="btn btn-dark btn-lg mb-2 mr-1">Manage Account</a>
                {% csrf_token %}
                <input type="submit" class="btn btn-dark btn-lg mb-2" value="Sign Out">
            </p>
        </form>
    {% else %}
        <p class="mb-4">
            To continue, you'll need to create a {{ request.site.name }} account or sign in to an existing one.
            You can do this using the buttons below.
        </p>
        <p class="mb-5">
            <a href="{% url 'account_signup' %}" class="btn btn-dark btn-lg mb-2 mr-1">Create Account</a>
            <a href="{% url 'account_login' %}" class="btn btn-dark btn-lg mb-2">Sign In</a>

        </p>
    {% endif %}

    <h3 class="mb-3">Recent News</h3>
    <div class="row mb-2" id="blog-cards">
        {% cache 1800 index_blog %}
            {% for post in post_list %}
                <div class="col-lg-4">
                    <article class="card mb-4 index-card">

                        {% if post.image %}
                            <a href="{{ post.get_absolute_url }}">
                                <img class="card-img-top"
                                     src="{{ post.image.crop.300x150 }}"
                                     srcset="{{ post.image.crop.300x150 }} 1x, {{ post.image.crop.600x300 }} 2x"
                                     alt="">
                            </a>
                        {% endif %}

                        <div class="card-body">
                            <h5 class="card-title">
                                {{ post.title }}
                            </h5>
                            <h6 class="card-subtitle mb-2 text-muted">
                                {{ post.created | date:"F jS, Y" }}
                            </h6>
                            <p class="card-text">
                                {{ post.text_rendered | striptags | truncatechars:100 }}
                            </p>
                            <a href="{{ post.get_absolute_url }}" class="btn btn-primary"
                               aria-label="Read the full post.">Read more</a>
                        </div>

                    </article>
                </div>
            {% endfor %}
        {% endcache %}
    </div>

    <h3 class="mb-3">Upcoming Events</h3>
    <div class="row mb-2" id="event-cards">
        {% cache 1800 index_events %}
            {% for event in event_list %}
                <div class="col-lg-4">
                    <article class="card mb-4 bg-light index-card">
                        <div class="card-body">
                            <h5 class="card-title">{{ event.title }}</h5>
                            <p class="card-text">{{ event.what_rendered | striptags | truncatechars:140 }}</p>
                            <h6 class="mb-3">{{ event.start | date:"F jS, Y" }}</h6>
                            <a href="{{ event.get_absolute_url }}" class="btn btn-outline-primary">View event</a>
                        </div>
                    </article>
                </div>
            {% endfor %}
        {% endcache %}
    </div>
{% endblock content %}